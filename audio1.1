<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Greenpoint Listening</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.5;margin:0;background:#fff;}
  .app{max-width:980px;margin:0 auto;padding:18px;}
  .card{border:1px solid #e3e3e3;border-radius:16px;padding:18px;margin:14px 0;}
  h1{margin:0 0 6px;font-size:26px;}
  .sub{margin:0 0 16px;opacity:.75;}
  audio{width:100%; margin:10px 0; }
  button{padding:10px 14px;font-size:14px;border-radius:10px;border:1px solid #bbb;background:#fff;cursor:pointer;}
  button:hover{background:#f6f6f6;}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 0;}
  .hidden{display:none;}

  /* Clean transcript */
  .dialogue{margin-top:10px;}
  .line{opacity:0;transform:translateY(4px);transition:opacity 200ms ease,transform 200ms ease;margin:4px 0;padding:0;background:transparent;}
  .line.visible{opacity:1;transform:translateY(0);}
  .line.past{opacity:.6;}
  .line.current{opacity:1;padding-left:10px;border-left:3px solid #ddd;}
  .speaker{font-weight:800;margin-right:6px;}
  .maria .speaker{color:#1f4e79;}
  .ali .speaker{color:#6a1b9a;}
  .note{margin-top:10px; font-size:14px; opacity:.8;}
</style>
</head>
<body>
<div class="app" id="app"></div>

<script>
(() => {
  const mp3 = "https://uploads.teachablecdn.com/attachments/0f3bc5a9809446919365dd5bcda413bc.mp3";

  const lines = [
    { t: 0.00, speaker: "Maria", cls: "maria", text: "License plate number A647, that must be my Uber. Hello, are you my driver?" },
    { t: 7.72, speaker: "Ali",   cls: "ali",   text: "Hi. Yes, I’m Ali. Please get in. So you’re going to Greenpoint?" },
    { t: 16.14, speaker: "Maria", cls: "maria", text: "Um, I think I’m going to… Manhattan? The address I gave is 1026 Manhattan Avenue. Isn’t that in Manhattan." },
    { t: 27.06, speaker: "Ali",   cls: "ali",   text: "It must be your first time in New York. Where are you from?" },
    { t: 32.90, speaker: "Maria", cls: "maria", text: "Russia. Yeah, my first time. So, we’re not going to Manhattan? We’re going to… Green pond?" },
    { t: 42.67, speaker: "Ali",   cls: "ali",   text: "Greenpoint. It’s in Brooklyn." },
    { t: 46.62, speaker: "Maria", cls: "maria", text: "Oh?! Is it far from Manhattan?" },
    { t: 50.62, speaker: "Ali",   cls: "ali",   text: "Well, it’s a little hard to get to Manhattan from there. It’s a little bit, what’s the word?" },
    { t: 58.15, speaker: "Maria", cls: "maria", text: "Remote?" },
    { t: 60.02, speaker: "Ali",   cls: "ali",   text: "Yeah, a little remote. But it’s a very cool neighborhood. It's, you know, very busy with restaurants." },
    { t: 72.42, speaker: "Maria", cls: "maria", text: "It’s got a good restaurant scene?" },
    { t: 73.91, speaker: "Ali",   cls: "ali",   text: "Right. A good restaurant scene and a good nightlife scene as well. And you know, like lots of young people, it’s you know like…" },
    { t: 83.37, speaker: "Maria", cls: "maria", text: "You mean it’s a lively neighborhood." },
    { t: 86.36, speaker: "Ali",   cls: "ali",   text: "Yes, exactly: lively. Your English is really good." },
    { t: 92.31, speaker: "Maria", cls: "maria", text: "Oh, thank you. I actually used to be an English teacher in Russia." },
    { t: 98.17, speaker: "Ali",   cls: "ali",   text: "And I was a doctor in my home country (laughs) and now I drive a taxi in New York. What a life!" }
  ];

  const el = document.getElementById("app");
  el.innerHTML = `
    <h1>Greenpoint Listening</h1>
    <p class="sub">Play the audio. Click “Show dialogue” only if you need support.</p>

    <div class="card">
      <audio id="a" controls preload="metadata">
        <source src="${mp3}" type="audio/mpeg" />
      </audio>

      <div class="controls">
        <button id="show" type="button">Show dialogue</button>
        <button id="hide" type="button" class="hidden">Hide dialogue</button>
        <button id="full" type="button" class="hidden">Show full transcript</button>
      </div>

      <div id="dlg" class="dialogue hidden" aria-live="polite"></div>
      <div class="note">Tip: click a revealed line to jump to that moment.</div>
    </div>
  `;

  const audio = document.getElementById("a");
  const dlg = document.getElementById("dlg");
  const showBtn = document.getElementById("show");
  const hideBtn = document.getElementById("hide");
  const fullBtn = document.getElementById("full");

  let enabled = false;
  let lastShown = -1;
  let currentIdx = -1;

  const nodes = lines.map(line => {
    const div = document.createElement("div");
    div.className = `line ${line.cls}`;
    div.innerHTML = `<span class="speaker">${line.speaker}:</span><span>${line.text}</span>`;
    div.addEventListener("click", () => { audio.currentTime = line.t; audio.play(); });
    dlg.appendChild(div);
    return div;
  });

  function clearStates(){
    nodes.forEach(n => n.classList.remove("visible","past","current"));
    lastShown = -1;
    currentIdx = -1;
  }

  function setCurrent(idx){
    if (currentIdx === idx) return;
    if (currentIdx >= 0){
      nodes[currentIdx].classList.remove("current");
      nodes[currentIdx].classList.add("past");
    }
    currentIdx = idx;
    nodes[currentIdx].classList.add("current","visible");
    nodes[currentIdx].classList.remove("past");
  }

  function revealUpTo(t){
    if (!enabled) return;

    while (lastShown + 1 < lines.length && lines[lastShown + 1].t <= t + 0.05){
      lastShown++;
      nodes[lastShown].classList.add("visible","past");
      nodes[lastShown].classList.remove("current");
    }

    let idx = -1;
    for (let i=0;i<lines.length;i++){
      if (lines[i].t <= t + 0.05) idx = i;
      else break;
    }
    if (idx >= 0 && idx <= lastShown) setCurrent(idx);
  }

  audio.addEventListener("timeupdate", () => revealUpTo(audio.currentTime));
  audio.addEventListener("seeked", () => { if (enabled) { clearStates(); revealUpTo(audio.currentTime); } });

  showBtn.addEventListener("click", () => {
    enabled = true;
    dlg.classList.remove("hidden");
    showBtn.classList.add("hidden");
    hideBtn.classList.remove("hidden");
    fullBtn.classList.remove("hidden");
    clearStates();
    revealUpTo(audio.currentTime);
  });

  hideBtn.addEventListener("click", () => {
    enabled = false;
    dlg.classList.add("hidden");
    showBtn.classList.remove("hidden");
    hideBtn.classList.add("hidden");
    fullBtn.classList.add("hidden");
    clearStates();
  });

  fullBtn.addEventListener("click", () => {
    if (!enabled) return;
    nodes.forEach(n => { n.classList.add("visible","past"); n.classList.remove("current"); });
    lastShown = nodes.length - 1;
    currentIdx = -1;
  });
})();
</script>
</body>
</html>
